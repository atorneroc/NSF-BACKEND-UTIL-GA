name: Backend CD (.NET 8)

# Este pipeline se ejecuta autom√°ticamente despu√©s del pipeline de CI
on:
  workflow_run:
    workflows: ["Backend CI (.NET 8)"] # Nombre del pipeline de CI que dispara este CD
    types:
      - completed

permissions:
  contents: read

jobs:
  validate-and-deploy:
    name: Validate Artifact and Trigger Azure Deployment
    runs-on: ubuntu-latest

    steps:
      # 1. Descargar artefacto generado por el pipeline de CI
      - name: üß∞ Descargar artefacto del pipeline de CI
        uses: actions/download-artifact@v4
        with:
          name: backend-artifact # Nombre del artefacto generado en CI
          path: ./publish # Directorio donde se descargar√° el artefacto

      # 2. Validar que el artefacto existe y est√° correcto
      - name: ‚úÖ Validar artefacto
        run: |
          if [ ! -d "./publish" ]; then
            echo "El artefacto no fue descargado correctamente. Verifica el pipeline de CI."
            exit 1
          fi
          echo "Artefacto validado correctamente. Azure gestionar√° el despliegue."

      # 3. Informar que Azure manejar√° el despliegue autom√°ticamente
      - name: üöÄ Despliegue gestionado por Azure
        run: echo "El despliegue se realizar√° autom√°ticamente por Azure App Service."