name: Backend CD (.NET 8)

# Este pipeline se ejecuta automÃ¡ticamente despuÃ©s del pipeline de CI
on:
  workflow_run:
    workflows: ["Backend CI (.NET 8)"] # Nombre del pipeline de CI que dispara este CD
    types:
      - completed

permissions:
  contents: read

jobs:
  validate-and-deploy:
    name: Validate Artifact and Trigger Azure Deployment
    runs-on: ubuntu-latest

    steps:
      # 0. Listar artefactos disponibles
      - name: ğŸ” Listar artefactos disponibles
        run: ls -la
      # 1. Descargar artefacto generado por el pipeline de CI
      - name: ğŸ§° Descargar artefacto del pipeline de CI
        uses: actions/download-artifact@v4
        with:
          name: backend-artifact # Nombre del artefacto generado en CI
          path: ./publish # Directorio donde se descargarÃ¡ el artefacto

      # 2. Validar que el artefacto existe y estÃ¡ correcto
      - name: âœ… Validar artefacto
        run: |
          if [ ! -d "./publish" ]; then
            echo "El artefacto no fue descargado correctamente. Verifica el pipeline de CI."
            exit 1
          fi
          echo "Artefacto validado correctamente. Azure gestionarÃ¡ el despliegue."

      # 3. Informar que Azure manejarÃ¡ el despliegue automÃ¡ticamente
      - name: ğŸš€ Despliegue gestionado por Azure
        run: echo "El despliegue se realizarÃ¡ automÃ¡ticamente por Azure App Service."